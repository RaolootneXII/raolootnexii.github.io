<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
  <title>Segunda Lei de Mendel</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');

    * {
      padding: 0;
      margin: 0;
      transition: all .5s;
    }

    body {
      background-color: #130f40;
      font-family: 'Fredoka One';
      color: #fff;
    }

    #box {
      text-align: center;
      width: 60%;
      margin: 0 auto;
    }

    #box h1 {
      font-size: 6rem;
      margin-bottom: 30px;
    }

    #box #flex {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
    }

    #box form input {
      height: 50px;
      flex: 4;
      text-align: center;
      font-size: 1.5rem;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, .6);
      background-color: #130f40;
      color: #fff;
    }

    #box #x {
      flex: 1;
      text-align: center;
      font-size: 2rem;
      margin-top: -5px;
    }

    #box button {
      padding: 10px;
      border-radius: 10px;
      margin-top: 20px;
      border: 1px solid rgba(0, 0, 0, .5);
      font-size: 1.2rem;
      margin-bottom: 10px;
      background-color: #3c40c6;
      color: #fff;
    }

    .msg {
      opacity: 0;
      font-size: large;
      margin: 10px 0;
      padding: 3px 0;
    }

    #passarPasso {
      font-size: 20px;
      padding: 10px;
      height: 50px;
      width: 50px;
      border-radius: 50%;
      background-color: #fff;
      border: 1px solid rgba(0, 0, 0, .5);
      position: fixed;
      bottom: 100px;
      right: 100px;
      font-weight: bolder;
      opacity: 0;
    }

    .d1 {
      width: 56px;
      height: 25px;
      text-align: center;
      font-size: 1.2rem;
      border-radius: 3px;
      margin: 0 10px;
      border: 1px solid rgba(255, 255, 255, .6);
      background-color: #130f40;
      color: #fff;
    }

    table {
      width: 100%;
      height: 300px;
      background-color: rgb(255, 255, 255);
      border-radius: 1px;
      border: 1px;
      margin-bottom: 30px;
      border-collapse: collapse;
      color: #000;
      font-weight: 300;
    }

    table,
    th {
      border: 1px solid rgba(255, 255, 255, .6);
    }
    td {
      border: 1px solid rgba(0, 0, 0, .1);
    }

    td input {
      width: 100%;
      height: 100%;
      border: none;
      text-align: center;
      font-size: 1.2rem;
      border: none;
    }
    td input:disabled {
      color: #fff;
    }
    .cabecote {
      margin-right: 5px;
    padding-right: 18px;
    height: 71px;
    border-right: 1px solid rgba(255, 255, 255, 0.2);
    }
    .msg-mendel {
      display: flex;
    }
  </style>
</head>

<body>
  <button id="passarPasso">></button>
  <div id="box">
    <h1>Segunda Lei de Mendel <img src="gregor-mendel-corpo.png" alt="" style="width: 60px;"></h1>
    <form>
      <div id="flex">
        <input type="text" name="" id="indv1" value="AaBb">
        <span id="x">x</span>
        <input type="text" name="" id="indv2" value="aabb">
      </div>
      <button id="btn-cruzar">Realizar Cruzamento</button>
    </form>
    <div id="passos1">
      <div class="msg msg-mendel" id="msg1">
        <img src="gregor-mendel-cabeca.png" class="cabecote">
        <p>Olá, meu pequeno estudante! Se está aqui, é porque você quer aprender mais sobre a Segunda Lei de Mendel (eu lindo, hehe) na prática. Como eu consegui chegar até essa teoria? A partir da observação e o teste realizado com ervilhas, notei que havia um certo padrão que poderia acontecer dependendo da geração com a qual trabalhava. O primeiro passo para realizar o cruzamento que você quer, é encontrar os grupinhos de alelos que podem ser formados por apenas um indivíduo. Aperte no botão inferior direito para eu te ajudar nessa jornada.</p>
      </div>
      <p class="msg" id="msg2">Inicialmente vamos separar cada alelo (par de genes) dos indivíduos!</p>
      <h5 class="msg" id="msg3" style="text-align: left;">Indivíduo 1:</h5>
      <p class="msg" id="msg4" style="text-align: left;"></p>
      <p class="msg" id="msg5" style="text-align: left;"></p>
      <div class="msg msg-mendel" id="msg6">
        <img src="gregor-mendel-cabeca.png" class="cabecote">
      <p style="text-align: left;">Entendeu? Agora encontre as combinações do outro indivíduo. Lembre-se do recurso de chuveirinho e observe bem o que eu fiz. :D</p>
      </div>
      <h5 class="msg" id="msg7" style="text-align: left;">Indivíduo 2:</h5>
      <p class="msg" id="msg8" style="text-align: left;"></p><br>
      <div class="msg msg-mendel" id="msg9">
        <img src="gregor-mendel-cabeca.png" class="cabecote">
        <p style="text-align: left;">PARABÉÉÉÉÉÉNS!!! Está pronto para iniciar de fato o cruzamento e saber quais serão os indivíduos que podem ser gerados??? EEIMMM? Então passa a para o próximo passo!</p><br>
      </div>
      <p class="msg" id="msg11">Primeiro eu vou criar uma tabela linda e maravilhosa para você</p>
      <table class="msg" id="msg12">
        <tr>
          <td style="width: 137px;height: 80px;"><img src="gregor-mendel.png" alt="" style="width: 80px;"></td>
          <td id="indv1par1">AB</td>
          <td id="indv1par2">Ab</td>
          <td id="indv1par3">aB</td>
          <td id="indv1par4">ab</td>
        </tr>
        <tr>
          <td style="height: 80px;" id="indv2par1">AB</td>
          <td><input type="text" class="d2" col=1 row=1></td>
          <td><input type="text" class="d2" col=2 row=1></td>
          <td><input type="text" class="d2" col=3 row=1></td>
          <td><input type="text" class="d2" col=4 row=1></td>
        </tr>
        <tr>
          <td style="height: 80px;" id="indv2par2">Ab</td>
          <td><input type="text" class="d2" col=1 row=2></td>
          <td><input type="text" class="d2" col=2 row=2></td>
          <td><input type="text" class="d2" col=3 row=2></td>
          <td><input type="text" class="d2" col=4 row=2></td>
        </tr>
        <tr>
          <td style="height: 80px;" id="indv2par3">aB</td>
          <td><input type="text" class="d2" col=1 row=3></td>
          <td><input type="text" class="d2" col=2 row=3></td>
          <td><input type="text" class="d2" col=3 row=3></td>
          <td><input type="text" class="d2" col=4 row=3></td>
        </tr>
        <tr>
          <td style="height: 80px;" id="indv2par4">ab</td>
          <td><input type="text" class="d2" col=1 row=4></td>
          <td><input type="text" class="d2" col=2 row=4></td>
          <td><input type="text" class="d2" col=3 row=4></td>
          <td><input type="text" class="d2" col=4 row=4></td>
        </tr>
      </table>
      <div class="msg msg-mendel" id="msg13">
        <img src="gregor-mendel-cabeca.png" class="cabecote">
        <p style="text-align: left;">Bicho, tu é esperto demais, outro nível. Einstein nem nos seus pés consegue tocar. Agora para finalizar, preciso que você me reponda algumas perguntas e assim teremos a análise geral.</p><br>
      </div>
      <div class="msg" id="msg14">
        <p style="text-align: left;">
          Os indivíduo que tem "<span id="letra1mai">A</span>" são:
          <input type="text" id="caractletra1mai" class="d3">
        </p>
        <p style="text-align: left;">
          Os indivíduo que tem "<span id="letra1min">a</span>" são:
          <input type="text" id="caractletra1min" class="d3">
        </p>
        <p style="text-align: left;">
          Os indivíduo que tem "<span id="letra2mai">B</span>" são:
          <input type="text" id="caractletra2mai" class="d3">
        </p>
        <p style="text-align: left;">
          Os indivíduo que tem "<span id="letra2min">b</span>" são:
          <input type="text" id="caractletra2min" class="d3">
        </p>
      </div>
      <div class="msg msg-mendel" id="msg15">
        <img src="gregor-mendel-cabeca.png" class="cabecote">
        <p style="text-align: left;">Com base no que você disse eu concluo que:</p>
        <p><span id="dd"></span> indivíduo(s) será(ão) <span class="caractletra1mai"></span> e <span class="caractletra2mai"></span>.</p>
        <p><span id="dr"></span> indivíduo(s) será(ão) <span class="caractletra1mai"></span> e <span class="caractletra2min"></span>.</p>
        <p><span id="rd"></span> indivíduo(s) será(ão) <span class="caractletra1min"></span> e <span class="caractletra2mai"></span>.</p>
        <p><span id="rr"></span> indivíduo(s) será(ão) <span class="caractletra1min"></span> e <span class="caractletra2min"></span>.</p>
        
        <br>
      </div>
    </div>
  </div>

  <script>
    var passo = 1;
    var indv1par1;
    var indv1par2;
    var indv1par3;
    var indv1par4;

    var indv2par1;
    var indv2par2;
    var indv2par3;
    var indv2par4;
    
    var letra1MIN;
    var letra2MIN;
    var letra1MAI;
    var letra2MAI;

    // [dd, rd, dr, rr]
    var caracteristicas = [0, 0, 0, 0];

    const passos1 = document.querySelector('#passos1');
    const passarPasso = document.querySelector('#passarPasso');
    const btnCruzar = document.querySelector('#btn-cruzar');
    const indv1 = document.querySelector("#indv1");
    const indv2 = document.querySelector("#indv2");
    btnCruzar.addEventListener('click', async (e) => {
      e.preventDefault();
      btnCruzar.style.opacity = '0';
      document.querySelector('#msg1').style.opacity = '1';
      //await new Promise(r => setTimeout(r, 3000));
      passarPasso.style.opacity = 1;
      passarPasso.addEventListener('click', async (e) => {
        if (passo == 1) {
          document.querySelector('#msg2').style.opacity = '1';
          passo++;
        } else if (passo == 2) {
          document.querySelector('#msg3').style.opacity = '1';
          divisao(document.querySelector('#msg4'), indv1.value);
          document.querySelector('#msg4').style.opacity = '1';
          passo++;
        } else if (passo == 3) {
          document.querySelector('#msg6').style.opacity = '1';
          document.querySelector('#msg7').style.opacity = '1';
          divisao2(document.querySelector('#msg8'), indv2.value);
          document.querySelector('#msg8').style.opacity = '1';
          passo++;
        } else if (passo == 4) {
          if (verificarD1() == false) {
            alert('Você ainda não cumpriu o desafio!');
          } else {
            document.querySelector('#msg9').style.opacity = '1';
            passo++;
          }
        } else if (passo == 5) {
          document.querySelector('#msg11').style.opacity = '1';
          passo++;
          await new Promise(r => setTimeout(r, 2000));
          document.querySelector('#msg12').style.opacity = '1';
          document.querySelector('#indv1par1').innerHTML = indv1par1;
          document.querySelector('#indv1par2').innerHTML = indv1par2;
          document.querySelector('#indv1par3').innerHTML = indv1par3;
          document.querySelector('#indv1par4').innerHTML = indv1par4;

          document.querySelector('#indv2par1').innerHTML = indv2par1;
          document.querySelector('#indv2par2').innerHTML = indv2par2;
          document.querySelector('#indv2par3').innerHTML = indv2par3;
          document.querySelector('#indv2par4').innerHTML = indv2par4;

          document.querySelector('#msg11').style.opacity = '0';
          await new Promise(r => setTimeout(r, 500));
          document.querySelector('#msg11').innerHTML = 'Basicamente, o que você precisa fazer é mais um chuveirinho! Vou fazer o primeiro pra você.';
          document.querySelector('#msg11').style.opacity = '1';
          await new Promise(r => setTimeout(r, 2000));
          const cell = document.querySelectorAll('.d2');
          cell.forEach(elem => {
            row_t = elem.getAttribute('row');
            col_t = elem.getAttribute('col');
            if (row_t == "1" && col_t == "1") {
              elem.value = respostaPorPos(row_t, col_t);
              elem.disabled = true;
              elem.style.backgroundColor = '#05c46b';
            }
            elem.addEventListener('change', (e) => {
              row_t = elem.getAttribute('row');
              col_t = elem.getAttribute('col');
              if (elem.value == respostaPorPos(row_t, col_t)) {
                elem.disabled = true;
                elem.style.backgroundColor = '#05c46b';
              } else {
                elem.style.backgroundColor = '#ff3f34';
              }
            });
          });

        } else if (passo == 6) {
          if (verificarD2() != true) {
            alert('Você ainda não cumpriu o segundo desafio!');
          } else {
            document.querySelector('#msg13').style.opacity = '1';
            document.querySelector('#msg14').style.opacity = '1';
            letra1MIN = indv1.value.substring(0, 1).toLowerCase();
            letra2MIN = indv1.value.substring(2, 3).toLowerCase();
            letra1MAI = indv1.value.substring(0, 1).toUpperCase();
            letra2MAI = indv1.value.substring(2, 3).toUpperCase();
            document.querySelector('#letra1mai').innerHTML = letra1MAI;
            document.querySelector('#letra1min').innerHTML = letra1MIN;
            document.querySelector('#letra2mai').innerHTML = letra2MAI;
            document.querySelector('#letra2min').innerHTML = letra2MIN;
            passo++;
          }
        } else if (passo == 7) {
          if (verificarD3() != true) {
            alert('Por favor, meu amigo, preencha as características!');
          } else {
            const caractletra1mai = document.querySelector('#caractletra1mai').value;
            const caractletra1min = document.querySelector('#caractletra1min').value;
            const caractletra2min = document.querySelector('#caractletra2min').value;
            const caractletra2mai = document.querySelector('#caractletra2mai').value;
            passo++;
            calcularIndv();
            document.querySelector('#dd').innerHTML = caracteristicas[0];
            document.querySelector('#dr').innerHTML = caracteristicas[1];
            document.querySelector('#rd').innerHTML = caracteristicas[2];
            document.querySelector('#rr').innerHTML = caracteristicas[3];
            document.querySelectorAll('.caractletra1mai').forEach(elem => {
              elem.innerHTML = caractletra1mai;
            });
            document.querySelectorAll('.caractletra1min').forEach(elem => {
              elem.innerHTML = caractletra1min;
            });
            document.querySelectorAll('.caractletra2mai').forEach(elem => {
              elem.innerHTML = caractletra2mai;
            });
            document.querySelectorAll('.caractletra2min').forEach(elem => {
              elem.innerHTML = caractletra2min;
            });
            document.querySelector('#msg15').style.opacity = '1';
          }
        }
      });
    });
    async function divisao(elemento, texto) {
      elemento.innerHTML += texto;
      //await new Promise(r => setTimeout(r, 2500));
      elemento.innerHTML += ` > (${texto.substring(0, 2)}) (${texto.substring(2, 4)})`;
      elemento.innerHTML += '<br><br>Lembra do conceito matemático popularmente chamado de chuveirinho?? Ex.: 2(2 + 1). O termo que está do lado de fora multiplica o que está dentro, ou seja, se junta. Resposta: (2.2 + 1.2). Aqui eu aplico esse método na realidade dos pares:<br><br><span class="msg" id="msg-especial"></span>';
      indv1par1 = texto.substring(0, 1) + texto.substring(2, 3);
      indv1par2 = texto.substring(0, 1) + texto.substring(3, 4);
      indv1par3 = texto.substring(1, 2) + texto.substring(2, 3);
      indv1par4 = texto.substring(1, 2) + texto.substring(3, 4);
      document.querySelector('#msg-especial').innerHTML = indv1par1 + ', ' + indv1par2 + ', ' + indv1par3 + ', ' + indv1par4;
      document.querySelector('#msg-especial').style.opacity = '1';
    }
    async function divisao2(elemento, texto) {
      elemento.innerHTML += texto;
      //await new Promise(r => setTimeout(r, 2500));
      elemento.innerHTML += ` > (${texto.substring(0, 2)}) (${texto.substring(2, 4)}) > `;
      indv2par1 = texto.substring(0, 1) + texto.substring(2, 3);
      indv2par2 = texto.substring(0, 1) + texto.substring(3, 4);
      indv2par3 = texto.substring(1, 2) + texto.substring(2, 3);
      indv2par4 = texto.substring(1, 2) + texto.substring(3, 4);
      for (i = 1; i <= 4; i++) {
        if (i == 1) {
          elemento.innerHTML += '<input class="d1" type="text" par="' + indv2par1 + '">';
        } else if (i == 2) {
          elemento.innerHTML += '<input class="d1" type="text" par="' + indv2par2 + '">';
        } else if (i == 3) {
          elemento.innerHTML += '<input class="d1" type="text" par="' + indv2par3 + '">';
        } else if (i == 4) {
          elemento.innerHTML += '<input class="d1" type="text" par="' + indv2par4 + '">';
        }
      }
      const desafio1 = document.querySelectorAll('.d1');
      desafio1.forEach(desafio => {
        desafio.addEventListener('change', (e) => {
          if (desafio.value == desafio.getAttribute('par')) {
            desafio.style.backgroundColor = '#05c46b';
            desafio.disabled = true;
          } else {
            desafio.style.backgroundColor = '#ff3f34';
          }
        });
      });
    }
    function verificarD1() {
      var desafios = document.querySelectorAll('.d1');
      var error = false;
      desafios.forEach(desafio => {
        if (desafio.disabled != true) {
          error = true;
        };
      });
      if (error)
        return false;
      else
        return true;
    }
    function verificarD2() {
      var desafios = document.querySelectorAll('.d2');
      var error = false;
      desafios.forEach(desafio => {
        if (desafio.disabled != true) {
          error = true;
        };
      });
      if (error)
        return false;
      else
        return true;
    }
    function verificarD3() {
      var desafios = document.querySelectorAll('.d3');
      var error = false;
      desafios.forEach(desafio => {
        if (desafio.value.trim().length == 0) {
          error = true;
        };
      });
      if (error)
        return false;
      else
        return true;
    }
    function calcularIndv() {
      
      for (let i = 1; i <= 4; i++) {
        for (let c = 1; c <= 4; c++) {
          res = respostaPorPos(i.toString(), c.toString());
          // Totalmente recessivo rr
          console.log(res.split(new RegExp(letra1MIN, 'g')).length-1)
          console.log(res.split(new RegExp(letra2MIN, 'g')).length-1)
          if (res.split(new RegExp(letra1MIN, 'g')).length-1 > 1 && res.split(new RegExp(letra2MIN, 'g')).length-1 > 1) {
            caracteristicas[3] += 1;
          // Recessivo no primeiro rd
          } else if (res.split(new RegExp(letra1MIN, 'g')).length-1 > 1 && res.split(new RegExp(letra2MIN, 'g')).length-1 <= 1) {
            caracteristicas[1] += 1;
          // Recessivo no segundo dr
          } else if (res.split(new RegExp(letra1MIN, 'g')).length-1 <= 1 && res.split(new RegExp(letra2MIN, 'g')).length-1 > 1) {
            caracteristicas[2] += 1;
          } else {
            caracteristicas[0] += 1;
          }
        }
      }
    }
    function respostaPorPos(row, col) {
      var par1, par2, par_row, par_col;
      switch (row) {
        case "1":
          par_row = indv2par1;
          break;
        case "2":
          par_row = indv2par2;
          break;
        case "3":
          par_row = indv2par3;
          break;
        case "4":
          par_row = indv2par4;
          break;
      }
      switch (col) {
        case "1":
          par_col = indv1par1;
          break;
        case "2":
          par_col = indv1par2;
          break;
        case "3":
          par_col = indv1par3;
          break;
        case "4":
          par_col = indv1par4;
          break;
      }
      primeiro_alelo_1 = par_col.substring(0, 1);
      primeiro_alelo_2 = par_row.substring(0, 1);
      segundo_alelo_1 = par_col.substring(1, 2);
      segundo_alelo_2 = par_row.substring(1, 2);
      if (primeiro_alelo_1 == primeiro_alelo_1.toUpperCase()) {
        par1 = primeiro_alelo_1 + primeiro_alelo_2;
      } else {
        par1 = primeiro_alelo_2 + primeiro_alelo_1;
      }
      if (segundo_alelo_1 == segundo_alelo_1.toUpperCase()) {
        par2 = segundo_alelo_1 + segundo_alelo_2;
      } else {
        par2 = segundo_alelo_2 + segundo_alelo_1;
      }
      return par1 + par2;
    }

  </script>

</body>

</html>